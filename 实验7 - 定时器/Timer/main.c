/****************************************Copyright (c)****************************************************
**                                        
**                                 
**
**--------------File Info---------------------------------------------------------------------------------
** File name:			main.c
** Last modified Date: 2015-4-16         
** Last Version:		   1.2
** Descriptions:							
**--------------------------------------------------------------------------------------------------------
** Created by:			FiYu
** Created date:		2014-11-12
** Version:			    1.0
** Descriptions:		定时器实验					
**--------------------------------------------------------------------------------------------------------
** Modified by:			FiYu
** Modified date:		
** Version:				
** Descriptions:		
** Rechecked by:			
**********************************************************************************************************/
#include <stdio.h> 
#include <reg24le1.h>
#include <stdint.h>


/*-------------------管脚定义--------------------------------------------------*/
#define  D1    P00  // 开发板上的指示灯D1


/* 开发板中nRF24LE1管脚配置
P00：输出，驱动D4	       P12：输入，按键检测S2  
P01：输出，驱动D5			   P13：输入，按键检测S3
P02：输出					       P14：输出
P03：输出，UART TXD			 P15：输出
P04：输入，UART RXD			 P16：输出
P06：输入，AIN6  AD检测
*/

#define TIMER0_VALUE  26666  //Timer0定时器定时20ms对应的数值

uint8_t count=0; //软件计数变量


/*******************************************************************************************************
 * 描  述 : 配置 IO P0.0和P0.1为输出
 * 入  参 : 无
 * 返回值 : 无
 *******************************************************************************************************/
void IO_Init(void)
{	
	P0DIR &= ~0x01;	   //配置P0.0为输出
	D1 = 1;            //设置D4初始状态为熄灭
}

/*******************************************************************************************************
 * 描  述 : 配置Timer0为16位定时器,定时时间20ms,开启中断
 * 入  参 : 无
 * 返回值 : 无
 *******************************************************************************************************/
void Timer0Init(void)
{
  TMOD = 0x01;	                     //16位定时器
  TH0  = (65536-TIMER0_VALUE)/256;	 //写入初值
  TL0  = (65536-TIMER0_VALUE)%256;
  ET0  = 1;		 //使能Timer0溢出中断
  EA   = 1;		 //使能全局中断
  TR0  = 1;		 //启动Timer0
}

/*******************************************************************************************************
 * 描  述 : 主函数
 * 入  参 : 无
 * 返回值 : 无
 *******************************************************************************************************/
void main(void)
{ 
  IO_Init();      //配置IO                                  
  Timer0Init();   //Timer0初始化
	
  while(1);       //死循环，等待Timer0溢出中断
}
/*******************************************************************************************************
 * 描  述 : Timer0中断服务函数
 * 入  参 : 无
 * 返回值 : 无
 *******************************************************************************************************/
void Timer0_irq() interrupt INTERRUPT_T0
{
  
  TH0=(65536-TIMER0_VALUE)/256;  //写入初值
  TL0=(65536-TIMER0_VALUE)%256;
  count++;      //软件计数器加1
  if(count==25)	//500ms时间到 
  {
    count=0;    //软件计数器清零
    D1 = ~D1;   //D1指示灯状态取反
  }
}
 /*********************************END FILE****************************************************************/	